@startuml
skinparam nodesep 50
'hide members

' --- RELATIONS ---
Student "1" -r- "3" Loan

Loan "*" -r-> "1" Book

BookRegister "1" -d-> "*" Book
BookRegister .u.|> "Register<T>"

StudentRegister "1" -d-> "*" Student
StudentRegister .u.|> "Register<T>"

LoanRegister "1" -d-> "*" Loan
LoanRegister .u.|> "Register<T>"

Library "1" -l-> "3" "Register<T>"

MainController "1" -l-> "1" Library
MainController .u.|> Refresh
MainController "1" -u-> "1" MenuBarController
MainController ..> BookRegisterController
MainController ..> StudentRegisterController
MainController ..> LoanRegisterController

MenuBarController "1" -r-> "1" Refresh
MenuBarController "1" -l-> "1" LibraryIOManager
MenuBarController "1" -d-> "1" Library
MenuBarController .u.|> ResultActions

LibraryIOManager ..> Library
LibraryIOManager "1" -u-> "1" ResultActions

StudentRegisterController "1" -d-> "1" "SideBarController"
LoanRegisterController "1" -d-> "1" "SideBarController"
BookRegisterController "1" -d-> "1" "SideBarController"

' --- CLASSES ---

class Student {
    - name : String
    - surname : String
    - studentId : String {readOnly}
    - email : String
    - activeLoans : List<Loan>

    + Student(name : String, surname : String, studentId : String, email : String)
    + getName() : String
    + getSurname() : String
    + getStudentId() : String
    + getEmail() : String
    + getActiveLoans() : List<Loan>
    + copy(newData : Student) : void
    + addActiveLoan(loanToAdd : Loan) : void
    + removeActiveLoan(loanToRemove : Loan) : void
    + isValid() : boolean
    + isAvailableForLoan() : boolean
    - isStudentIdValid(studentId : String) : boolean
    - isEmailValid(email : String) : boolean
}

class Loan {
    - loanId : UUID {readOnly}
    - student : Student {readOnly}
    - book : Book {readOnly}
    - loanEnd : LocalDate

    + Loan(student : Student, book : Book, loanEnd : LocalDate)
    + getLoanId() : UUID
    + getStudent() : Student
    + getBook() : Book
    + getLoanEnd() : LocalDate
    + isReturned() : boolean
    + setLoanEnd(loanEnd : LocalDate) : void
    + returnLoan() : void
    + activateLoan() : void
    + isDelay() : boolean
    - isActivable() : boolean
    - isValid() : boolean
}

class Book {
    - title : String
    - authors : List<String>
    - bookId : String {readOnly}
    - publishmentYear : int
    - availableCopies : int

    + Book(title : String, authors : List<String>, bookId : String, publishmentYear : int, availableCopies : int)
    + getTitle() : String
    + getAuthors() : List<String>
    + getBookId() : String
    + getPublishmentYear() : int
    + getAvailableCopies() : int
    + setAvailableCopies(availableCopies : int) : void
    + copy(newData : Book) : void
    + isAvailableForLoan() : boolean
    - isValid() : boolean
    - isBookIdValid(bookId : String) : boolean
    - isPublishmentYearValid(publishmentYear : int) : boolean
    - isAvailableCopiesValid(availableCopies : int) : boolean
}

interface "Register<T>" {
    + add(toAdd : T) : void
    + modify(oldItem : T, newItem : T) : void
    + remove(toRemove : T) : void
    + isUnique(toVerify : T) : boolean
    + getRegisterList() : List<T>
}

class BookRegister {
    - bookRegister : Set<Book>
    + BookRegister()
}

class StudentRegister {
    - studentRegister : Set<Student>
    + StudentRegister()
}

class LoanRegister {
    - loanRegister : Set<Loan>
    + LoanRegister()
}

class Library {
    - bookRegister : Register<Book>
    - studentRegister : Register<Student>
    - loanRegister : Register<Loan>

    + Library()
    + getBookRegister() : Register<Book>
    + getStudentRegister() : Register<Student>
    + getLoanRegister() : Register<Loan>
}

class MainController {
    - library : Library
    - bookTab : Tab
    - studentTab : Tab
    - loanTab : Tab
    - menuBarController : MenuBarController

    + initialize() : void
    - initializeRegisterControllers(library : Library) : void
}

interface Refresh {
    + refresh(newLibrary : Library) : void
}

class MenuBarController {
    - menuBar : MenuBar
    - libraryIOManager : LibraryIOManager
    - defaultSavePath : String
    - mainRefresher : Refresh
    - library : Library

    + initialize() : void
    + setLibrary(library : Library) : void
    + setMainRefresher(mainRefresher : Refresh) : void
    + openFile(event : ActionEvent) : void
    + closeFile(event : ActionEvent) : void
    + saveFile(event : ActionEvent) : void
    + saveFileWithName(event : ActionEvent) : void
    - fileSelection(openFile : boolean) : File
    - showAlert(type : Alert.AlertType, title : String, header : String, content : String) : void
}

class LibraryIOManager {
    - resultActions : ResultActions

    + LibraryIOManager(actions : ResultActions)
    + saveLibrary(libraryToSave : Library, filePath : String) : void
    + loadLibrary(filePath : String) : Library
}

interface ResultActions {
    + success() : void
    + failure() : void
}

class StudentRegisterController {
    - studentTable : TableView<Student>
    - nameClm : TableColumn<Student, String>
    - surnameClm : TableColumn<Student, String>
    - studentIdClm : TableColumn<Student, String>
    - emailClm : TableColumn<Student, String>
    - studentRegister : Register<Student>
    - sideBarController : SideBarController

    + StudentRegisterController(studentRegister : Register<Student>)
    + initialize() : void
    + updateTableView() : void
    - openInsertPopup() : void
    - openModifyPopup() : void
    - removeFromRegister() : void
    - searchBook() : void
}

class LoanRegisterController {
    - loanTable : TableView<Loan>
    - studentNameClm : TableColumn<Loan, String>
    - studentSurnameClm : TableColumn<Loan, String>
    - studentIdClm : TableColumn<Loan, String>
    - bookNameClm : TableColumn<Loan, String>
    - bookIdClm : TableColumn<Loan, String>
    - loanEndClm : TableColumn<Loan, LocalDate>
    - returnedClm : TableColumn<Loan, String>
    - library : Library
    - sideBarController : SideBarController
    - loanInsertPopupController : LoanInsertPopupController
    - loanModifyPopupController : LoanModifyPopupController

    + LoanRegisterController(library : Library)
    + initialize() : void
    - openInsertPopup() : void
    - openModifyPopup() : void
    - removeFromRegister() : void
    - updateTableView() : void
    - searchLoan() : void
}

class BookRegisterController {
    - bookTable : TableView<Book>
    - titleClm : TableColumn<Book, String>
    - authorsClm : TableColumn<Book, String>
    - publishmentYearClm : TableColumn<Book, Integer>
    - bookIdClm : TableColumn<Book, String>
    - availableCopiesClm : TableColumn<Book, Integer>
    - bookRegister : Register<Book>
    - sideBarController : SideBarController

    + BookRegisterController(bookRegister : Register<Book>)
    + initialize() : void
    - openInsertPopup() : void
    - openModifyPopup() : void
    - removeFromRegister() : void
    + updateTableView() : void
    - searchBook() : void
}

class SideBarController {
    - addBtn : Button
    - searchBarTF : TextField
    - removeBtn : Button
    - modifyBtn : Button

    + getAddBtn() : Button
    + getSearchBarTF() : TextField
    + getRemoveBtn() : Button
    + getModifyBtn() : Button
}
@enduml